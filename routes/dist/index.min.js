"use strict";function _defineProperty(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var express=require("express"),router=express.Router(),XLSX=require("xlsx"),pdfMakePrinter=require("pdfmake/src/printer"),JsBarcode=require("jsbarcode"),_require=require("canvas"),Canvas=_require.Canvas,path=require("path");function generatePdf(t,e){try{var a={Roboto:{normal:path.join(__dirname,"./../fonts/Roboto-Regular.ttf"),bold:path.join(__dirname,"./../fonts/Roboto-Medium.ttf"),italics:path.join(__dirname,"./../fonts/Roboto-Italic.ttf"),bolditalics:path.join(__dirname,"./../fonts/Roboto-Italic.ttf")}},r=new pdfMakePrinter(a).createPdfKitDocument(t),n=[];r.on("data",function(t){n.push(t)}),r.on("end",function(){var t=Buffer.concat(n);e(t)}),r.end()}catch(t){throw t}}function GenerateBarCodeForNumber(e){return new Promise(function(a,r){var t=new Canvas;JsBarcode(t,e,{format:"CODE128",displayValue:!1}),t.toDataURL(function(t,e){t?r(t):a(e)})})}function formatPDFWithData(t){var e;return{pageMargins:[5,5,5,5],pageSize:{width:440.28,height:"auto"},content:[{style:"tableExample",table:{widths:["*","*"],body:[[[(e={text:t.Suppliername,style:"subheader",align:"right"},_defineProperty(e,"text",t.Supplierlocation),_defineProperty(e,"style","subheader"),_defineProperty(e,"margin",[35,0,10,0]),e)],[{text:"Supplier Product: ".concat(t.Supplierproduct),style:"subheader",margin:[25,0,10,0]},{text:"IRMS GCAS: ".concat(t.IRMSGCAS),style:"subheader",margin:[25,0,10,0]},{text:"Prod Date: ".concat(t.prdDate),style:"subheader",margin:[25,0,10,0]}]],[{text:"ITEM: ".concat(t.MaterialDescription),style:"subheader",color:"black",align:"right",colSpan:2}],[[{text:"WIDTH (MM):                 HEIGHT (MM):          ".concat(t.WIDTH,"                   \t\t\t\t   ").concat(t.quantity1," "),style:"subheader"}],[{text:"GROSS wt.(KG):          NET wt.(KG):           ".concat(t.quantity2,"                   \t\t\t\t   ").concat(t.quantity3),style:"subheader"}]],[[{text:"ROLL Dia(MM):      ROLLS(BLK)(MM):   ".concat(t.ROLLDIAMETER,"               \t\t\t\t   ").concat(t.quantity4," "),style:"subheader"}],[{text:"SPLICES:          BASIS WEIGHT(GSM):           ".concat(t.quantity5,"                   \t\t\t\t   ").concat(t.BASISWEIGHT," "),style:"subheader"}]],[[{text:"IRMS GCAS#: ".concat(t.IRMSGCAS),style:"subheader"}],[{text:"QUANTITY: ".concat(t.quantity," ").concat(t.manROLLSBLOCKS),style:"subheader"}]],[[{text:"LOT#: AHNL".concat(t.lotNumber),style:"subheader"}],[{text:"PO: ".concat(t.PO),style:"subheader"}]],[[{text:"CUSTOMER REF.: ",style:"subheader"}],[{text:"PALLETS / BUNDLE : ".concat(t.quantity6),style:"subheader"}]],[{stack:[{image:t.rowImage1.png,width:200,height:65},{text:t.rowImage1.number,style:"subheader",margin:[10,0,10,0]}],colSpan:2,margin:[100,0,10,0]}],[{stack:[{image:t.rowImage2.png,width:200,height:65},{text:t.rowImage2.number,style:"subheader",margin:[10,0,10,0]}],colSpan:2,margin:[100,0,10,0]}],[{stack:[{image:t.rowImage3.png,width:200,height:65},{text:t.rowImage3.number,style:"subheader",margin:[10,0,10,0]}],colSpan:2,margin:[100,0,10,0]}]]}}],styles:{header:{fontSize:14,bold:!0,margin:[0,0,0,10]},subheader:{fontSize:12,bold:!0,margin:[0,10,0,5]},tableExample:{margin:[0,0,0,-10]},tableHeader:{bold:!0,fontSize:9,color:"black"}},defaultStyle:{}}}router.get("/",function(t,e,a){e.render("home",{title:"Express"})}),router.get("/go",function(t,e,a){e.render("Materialdetail",{title:"Express"})}),router.post("/receivexlxs",function(t,e,a){var r=XLSX.readFile("BarcodeGenerator/public/spreadsheets/Plant_001_masterdata.xlsx"),n=r.SheetNames;XLSX.utils.sheet_to_json(r.Sheets[n[0]]);e.send("respond with a resource")}),router.post("/submitLogin",function(t,e,a){e.render("Materialdetail",null)}),router.post("/getcodes",function(t,e,a){var r=XLSX.readFile("BarcodeGenerator/public/spreadsheets/Plant_001_masterdata.xlsx"),n=r.SheetNames,o=XLSX.utils.sheet_to_json(r.Sheets[n[0]]);o.filter(function(t){return t.IRMS/GCAS==="91238465"});e.render("QRCodes",{title:"list",matertialList:o})}),router.post("/generatepdf",function(t,r,e){var a=t.body.material,n=t.body.PO,o=t.body.batch,i=t.body.prdDate,s=t.body.quantity,u=t.body.quantity1,c=t.body.quantity2,d=t.body.quantity3,l=t.body.quantity4,h=t.body.quantity5,b=t.body.quantity6,m=t.body.quantity7,y=XLSX.readFile(__dirname+"/Plant_001_masterdata.xlsx"),p=y.SheetNames,f=XLSX.utils.sheet_to_json(y.Sheets[p[0]]).filter(function(t){return t.IRMSGCAS===parseInt(a)});if(f.length<=0)r.render("Materialdetail");else{var S=f[0],g="(91) ".concat(S.IRMSGCAS,"(37)").concat(s),x="(10)AHNL".concat(o,"~(90)NONE"),_="(00) 1 1534145 40011".concat(b," 9");GenerateBarCodeForNumber("91".concat(S.IRMSGCAS,"37").concat(s)).then(function(a){GenerateBarCodeForNumber("10AHNL".concat(o,"90")).then(function(e){GenerateBarCodeForNumber("001153414540011".concat(b,"9")).then(function(t){S.lotNumber=o,S.prdDate=i,S.quantity=s,S.quantity1=u,S.quantity2=c,S.quantity3=d,S.quantity4=l,S.quantity5=h,S.quantity6=b,S.quantity7=m,S.PO=n,S.rowImage1={png:a,number:g},S.rowImage2={png:e,number:x},S.rowImage3={png:t,number:_},generatePdf(formatPDFWithData(f[0]),function(t){r.contentType("application/pdf"),r.send(t)})}).catch(function(t){})}).catch(function(t){})}).catch(function(t){})}}),router.post("/login",function(e,t){var a=XLSX.readFile(__dirname+"/Plant_userdata.xlsx"),r=XLSX.utils.sheet_to_json(a.Sheets[a.SheetNames[0]]).filter(function(t){return t.Username==e.body.username});0<r.length&&r[0].Password==e.body.pass?t.render("Materialdetail"):t.status(401).render("home")}),module.exports=router;
//# sourceMappingURL=index.min.js.map
